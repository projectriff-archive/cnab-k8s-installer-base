steps:
- script: |
    docker run -d -p 5000:5000 registry:2
    sudo sed -i 's/127.0.0.1\slocalhost/127.0.0.1     localhost registry.pfs.svc.cluster.local/g' /etc/hosts
  displayName: 'setup registry'


- script: |
    sudo ifconfig lo:0 $DEV_IP
    kubectl create namespace pfs
    cat <<EOF | kubectl create -f -
    ---
    kind: Service
    apiVersion: v1
    metadata:
      name: registry
      namespace: pfs
    spec:
      ports:
      - protocol: TCP
        port: 5000
        targetPort: 5000
    ---
    kind: Endpoints
    apiVersion: v1
    metadata:
      name: registry
      namespace: pfs
    subsets:
      - addresses:
          - ip: $DEV_IP
        ports:
          - port: 5000
    EOF
  displayName: 'create registry service'
  env:
    DEV_IP: 172.16.1.1
